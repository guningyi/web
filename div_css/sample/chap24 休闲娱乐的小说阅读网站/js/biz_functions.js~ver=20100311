window.MM=window.MM||{};MM.biz_announce_track=function(c,a){var b="0";if(c){b="1"}new Ajax.Request("/track_biz_announce.php",{parameters:"bid="+json_biz.id+"&aid="+a+"&click="+b})};MM.biz_announce=function(b,a,c){this.id_str=b;this.el=$(b);this.desc_str=c;this.announcement_id=a;this.announce_snip=this.el.innerHTML;this.start=this.el.getHeight();this._announce_tracked=false;Event.observe($(b+"_more"),"click",this.show_ad.bind(this));Event.observe($(b+"_less"),"click",this.hide_ad.bind(this))};MM.biz_announce.prototype.show_ad=function(){this.el.setStyle({height:this.start+"px"});this.el.innerHTML=this.desc_str;var a=this.el.scrollHeight;this.el.morph("height:"+a+"px",{duration:0.3});$(this.id_str+"_more").hide();$(this.id_str+"_less").show()};MM.biz_announce.prototype.hide_ad=function(){this.el.morph("height:"+this.start+"px",{duration:0.3});this.reset.bind(this).delay(0.2)};MM.biz_announce.prototype.reset=function(){this.el.innerHTML=this.announce_snip;$(this.id_str+"_less").hide();$(this.id_str+"_more").show()};MM.biz_map_init=function(){var b=$("biz_marker");var e=$("zoom_in");var a=$("zoom_out");var g=false;if(Prototype.Browser.IE){var c=navigator.userAgent;var d=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(d.exec(c)!=null){var f=parseFloat(RegExp.$1);if((f>=6)&&((new RegExp("SV1")).exec(c)!=null)){g=true}}}[b,e,a].each(mm.ui.pngFix);Event.observe(e,"click",MM.biz_map_activate);Event.observe(a,"click",MM.biz_map_activate)};var bizMap;MM.biz_map_activate=function(b){var a=b.element();mm.async.Script.load(gmapsUrl+"&async=2",function(){mm.async.Script.load(mm.jsurl("map_utilities.js"),function(){if(!bizMap){bizMap=new MM.biz_details_map(a)}})})};MM.biz_details_map=Class.create({initialize:function(d){var e=$("biz_marker").parentNode.href;$("biz_marker","static_map").invoke("remove");Event.stopObserving($("zoom_in"),"click",MM.biz_map_activate);Event.stopObserving($("zoom_out"),"click",MM.biz_map_activate);var c=$("zoom_in").remove();var b=$("zoom_out").remove();map=new GMap2($("mapdiv"));$("mapdiv").appendChild(c);$("mapdiv").appendChild(b);GEvent.addDomListener(c,"click",function(){map.zoomIn()});GEvent.addDomListener(b,"click",function(){map.zoomOut()});map.setCenter(new GLatLng(parseFloat(json_biz.latitude),parseFloat(json_biz.longitude)),15);var a=createBizMarker(json_biz,-1,false,e);map.addOverlay(a);copyrightTimer=window.setInterval("makeCopyrightSmaller()",150);if(d.id=="zoom_in"){map.zoomIn()}else{if(d.id=="zoom_out"){map.zoomOut()}}Event.observe(window,"unload",this.unload)},unload:function(){if(map){map.clearOverlays.call(map);GUnload()}map=null}});MM.directions={dObj:null,flag:null,ev:null,path:null,gsvClient:null,marker:null,pano:null,extraFlags:[],initialize:function(){Event.observe("get_directions_button","click",MM.directions.getDirections);Event.observe("swicther","click",MM.directions.switchDirections);Event.observe("start_point","keydown",MM.directions.keywatcher);var b=document.getElementById("directions_results");map=new GMap2(document.getElementById("directions_map"));map.setCenter(MM.directions.bizPoint.latlng,16);map.addControl(new GMapTypeControl());MM.directions.dObj=new GDirections(map,b);GEvent.addListener(MM.directions.dObj,"error",MM.directions.errorHandler);copyrightTimer=window.setInterval("makeCopyrightSmaller()",150);var c=document.createElement("img");var a=document.createElement("img");c.src=mm.imgurl("map/zoom_in.png");a.src=mm.imgurl("map/zoom_out.png");c.id="zoom_in";a.id="zoom_out";$("directions_map").appendChild(c);$("directions_map").appendChild(a);GEvent.addDomListener(c,"click",function(){map.zoomIn()});GEvent.addDomListener(a,"click",function(){map.zoomOut()});MM.directions.gsvClient=new GStreetviewClient();MM.directions.gsvClient.getNearestPanoramaLatLng(MM.directions.bizPoint.latlng,MM.directions.initGSV);var f=$("end_point").value.strip();var e=mm.util.location.getHashVars(window.location.href);if(e.start&&e.start!=f){var d=MM.directions.makePath(e.start,f);MM.directions.handleDirections(d);MM.directions.path=d;$("start_point").value=e.start}else{MM.directions.bizPoint.marker=new GxMarker(MM.directions.bizPoint.latlng,createSliceIcon(-1,SLICE_STYLE_NORMAL),"","");map.addOverlay(MM.directions.bizPoint.marker)}},initGSV:function(b){if(b){var a=map.getBounds();if(a.containsLatLng(b)){MM.directions.gsvOverlay=new GStreetviewOverlay();map.addOverlay(MM.directions.gsvOverlay);MM.directions.gsvOverlay.hide();map.getContainer().appendChild(mm.dom.div({id:"gsvToggle","class":"off"},mm.dom.div("Street View")));Event.observe("gsvToggle","click",function(){if(MM.directions.gsvOverlay.isHidden()){MM.directions.gsvOverlay.show();this.removeClassName("off")}else{MM.directions.gsvOverlay.hide();this.addClassName("off")}});MM.directions.marker=new GMarker(b);MM.directions.marker.bindInfoWindowHtml('<div id="pano"></div>');map.addOverlay(MM.directions.marker);MM.directions.marker.hide();GEvent.addListener(MM.directions.marker,"infowindowclose",function(c){c.hide();MM.directions.pano=null});GEvent.addListener(MM.directions.marker,"infowindowopen",function(c){MM.directions.pano=new GStreetviewPanorama(document.getElementById("pano"),{latlng:c.getLatLng()})});GEvent.addListener(map,"click",MM.directions.gsvOverlayClick)}}},gsvOverlayClick:function(b,a){var c=!b;if(!MM.directions.gsvOverlay.isHidden()){if(c&&a){MM.directions.gsvClient.getNearestPanoramaLatLng(a,function(d){if(d){MM.directions.showPano(d,true)}})}else{if(b==MM.directions.bizPoint.marker){MM.directions.showPano(MM.directions.bizPoint.latlng,false)}}}},showPano:function(b,a){MM.directions.marker.setLatLng(b);if(a){MM.directions.marker.show()}GEvent.trigger(MM.directions.marker,"click")},errorHandler:function(){var b=MM.directions.dObj.getStatus().code;if(b==604||b==602){var d=$("start_point").value.strip();var a=$("end_point").value.strip();if(d.indexOf(",")<0){var c=d+", "+current_location;$("start_point").value=c;MM.directions.getDirections()}else{if(a.indexOf(",")<0){var c=a+", "+current_location;$("end_point").value=c;MM.directions.getDirections()}else{if(b==604){alert("Sorry, we can't find a route between those two places.")}else{alert("We didn't recognize one of your addresses. Please enter at least a street address and city/town/suburb.")}}}}else{alert("Error: code"+b)}},getDirections:function(){var d=$("start_point").value.strip();var c=$("end_point").value.strip();if(d!=""&&c!=""){var b=MM.directions.makePath(d,c);MM.directions.dObj.clear();MM.directions.bizPoint.marker.hide();if(MM.directions.extraFlags){MM.directions.extraFlags.each(function(e){map.removeOverlay(e)});MM.directions.extraFlags=[]}if(MM.directions.marker&&MM.directions.gsvOverlay){MM.directions.marker.hide();MM.directions.marker.closeInfoWindow();map.removeOverlay(MM.directions.gsvOverlay);$("gsvToggle").addClassName("off")}MM.directions.handleDirections(b);MM.directions.path=b;window.location.hash=mm.util.location.writeHashVars({start:d});var a=(d.strip()!=MM.directions.bizPoint.address)?d:(c!=MM.directions.bizPoint.address)?c:false}else{alert("Please enter both a start and end address.")}},handleDirections:function(a){if(!$("directions_map").hasClassName("withDirections")){$("directions_map").addClassName("withDirections");$("directions_results").show();map.checkResize()}MM.directions.dObj.load(a,{locale:"en_NZ"});MM.directions.ev=GEvent.addListener(MM.directions.dObj,"load",MM.directions.resetIcons)},hideMarker:function(a){var b=a.getIcon();b.image=mm.imgurl("p.gif");b.iconSize=new GSize(1,1);b.iconAnchor=new GPoint(1,1);b.shadow=mm.imgurl("p.gif");b.shadowSize=new GSize(1,1);a.redraw()},resetIcons:function(){var f=MM.directions.dObj.getMarker(0);MM.directions.hideMarker(f);var a=MM.directions.dObj.getMarker(1);MM.directions.hideMarker(a);var e=new GIcon();e.image=(imagesPrefix+"map/marker_blue.png");e.iconSize=new GSize(23,30);e.iconAnchor=new GPoint(15,31);e.infoWindowAnchor=new GPoint(15,3);var d=new GMarker(a.getLatLng(),{icon:e});GEvent.addListener(d,"click",function(g){if(MM.directions.gsvOverlay.isHidden()){this.showMapBlowup()}else{MM.directions.showPano(this.getLatLng(),false)}});map.addOverlay(d);MM.directions.extraFlags.push(d);var c='<img src="'+mm.imgurl("map/loc_pin_flag.gif")+'" id="loc_pin_flag" width="41" height="48"/>';var b=new GxMarker(f.getLatLng(),createSliceIcon(-1,SLICE_STYLE_NORMAL),c,"");b.onClick=function(){if(!MM.directions.gsvOverlay.isHidden()){MM.directions.clearFlag();MM.directions.showPano(f.getLatLng(),false)}};map.addOverlay(b);MM.directions.flag=b;MM.directions.extraFlags.push(b);if(MM.directions.ev){GEvent.removeListener(MM.directions.ev);MM.directions.ev=null}window.setTimeout(function(){MM.directions.resetStepIcons()},500)},clearFlag:function(){if(MM.directions.flag){if(MM.directions.flag.tooltipObject){MM.directions.flag.tooltipObject.style.display="none"}GEvent.clearListeners(map,"moveend");MM.directions.flag=null}},resetStepIcons:function(){if(MM.directions.flag){MM.directions.flag.showMouseOver(false);MM.directions.flag.removeHighlight();if(MM.directions.flag.tooltipObject){var c=MM.directions.flag.tooltipObject.style.left.match(/\d+/);var b=MM.directions.flag.tooltipObject.style.top.match(/\d+/);MM.directions.flag.tooltipObject.style.left=(parseInt(c)-5)+"px";MM.directions.flag.tooltipObject.style.top=(parseInt(b)+3)+"px"}GEvent.addListener(map,"moveend",MM.directions.clearFlag)}var a=$$("#directions_results img");a.each(function(e){var d=mm.imgurl("map/map_marker_med"+((e==a.last())?"_blue.gif":".gif"));e.src=d});if(MM.directions.gsvOverlay){map.addOverlay(MM.directions.gsvOverlay);MM.directions.gsvOverlay.hide()}},keywatcher:function(a){if(a.keyCode==Event.KEY_RETURN){MM.directions.getDirections()}},switchDirections:function(){var d=$("start_point");var a=$("end_point");var c=d.value.strip();var b=a.value.strip();d.value=b;a.value=c;if(a.value==MM.directions.bizPoint.address){$("to_address").show()}else{$("to_address").hide()}if(c!=""&&b!=""){MM.directions.getDirections()}},makePath:function(c,b){var a="new zealand";if(c){c=c+", "+a}if(b){b=b+", "+a}return c+" to "+b}};